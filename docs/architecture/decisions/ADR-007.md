# ADR-007: Why Edge Functions over traditional backend (Deno runtime)

## Status

Accepted

## Context

The platform needs serverless API logic for OAuth flows, admin operations (users, apps, groups, permissions), and utility endpoints. Options considered:

- **Express.js server**: Full control, but requires hosting, scaling, and maintenance
- **AWS Lambda**: Mature serverless, but separate from database and auth
- **Supabase Edge Functions**: Co-located with Supabase, Deno runtime

## Decision

Use **Supabase Edge Functions** (Deno runtime) for all serverless API logic. Functions handle:

- OAuth 2.0 + PKCE (authorize, token, userinfo)
- Admin CRUD (users, apps, groups, permissions)
- Webhooks and utility endpoints

Functions are deployed via Supabase CLI or MCP and use `verify_jwt: false` where custom SSO tokens are required, with explicit JWT verification in code.

## Consequences

**Positive**

- Zero infrastructure management â€” no servers, no scaling config
- Co-located with database; low latency for auth and admin
- Same deployment pipeline as the rest of the Supabase project
- Deno offers secure-by-default execution and modern TypeScript support

**Negative**

- Deno ecosystem smaller than Node.js; some npm packages require compatibility layers
- Cold start latency acceptable for admin operations but may matter for high-throughput APIs
- Debugging and local testing require Supabase CLI or emulator
