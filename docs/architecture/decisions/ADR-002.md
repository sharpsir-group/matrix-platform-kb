# ADR-002: Why dual-Supabase (SSO + per-app DB) over schema-based multi-tenancy

## Status

Accepted

## Context

The platform serves 12 applications that require shared authentication but separate business data. Three approaches were considered:

- **Single DB with schemas**: One PostgreSQL instance, separate schemas per app
- **Single DB with RLS**: One instance, RLS policies filter by app/tenant
- **Separate DBs**: One SSO instance + one app-specific instance per application

Concerns included: identity isolation, data sovereignty, and the ability to scale or migrate individual apps independently.

## Decision

Use **two Supabase instances per app**:

1. **SSO instance** (shared): Auth, users, groups, permissions, app registry
2. **App DB instance** (per app): Business data (listings, contacts, transactions, etc.)

Each app configures two Supabase clients and uses the SSO JWT for both. RLS policies on the App DB read claims from the shared JWT.

## Consequences

**Positive**

- Clean separation of identity (SSO) and domain data (App DB)
- Apps can be deployed to different regions or vendors without touching auth
- SSO instance can be scaled/backed up independently
- Simpler RLS: App DB policies only handle business scope, not auth plumbing

**Negative**

- Extra client configuration per app â€” two URLs, two keys
- JWT must be valid and trusted by both instances; custom claims must be consistent
- Cross-instance queries (e.g., user + listing) require two round-trips or an aggregation layer
